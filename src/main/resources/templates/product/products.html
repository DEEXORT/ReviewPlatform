<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<div th:fragment="productsContent">
  <div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4 border-bottom border-secondary pb-3">
      <h2 class="cyber-glitch-title">
        <span class="text-muted">DIR:</span> ./[[${categoryName != null ? categoryName : 'ALL_PRODUCTS'}]]
      </h2>
      <button class="btn btn-cyber" data-bs-toggle="modal" data-bs-target="#productModal"
              sec:authorize="hasAnyRole('ADMIN', 'MANAGER')">
        <i class="bi bi-plus-lg me-2"></i>NEW_PRODUCT
      </button>
    </div>

    <div class="terminal-window">
      <div class="table-responsive">
        <table class="table table-cyber mb-0">
          <thead>
          <tr>
            <th>ID</th>
            <th>TITLE</th>
            <th>CATEGORY</th>
            <th>RATING_INDEX</th>
            <th class="text-center">OPERATIONS</th>
          </tr>
          </thead>
          <tbody>
          <tr th:each="product : ${products}">
            <td class="font-monospace text-muted" th:text="${product.id}"></td>
            <td class="fw-bold text-info" th:text="${product.title}"></td>
            <td><span class="badge badge-cyber" th:text="${product.categoryName}"></span></td>
            <td>
              <div class="rating-vitals">
                <span class="rating-value" th:text="${product.rating}">4.5</span>
                <div class="vitals-bar">
                  <div class="vitals-fill" th:style="'width:' + (${product.rating} * 20) + '%'"></div>
                </div>
              </div>
            </td>
            <td class="text-center">
              <a th:href="@{/reviews/product/{id}(id=${product.id})}" class="btn btn-sm btn-cyber-sm">
                <i class="bi bi-star"></i>
              </a>
              <a th:href="@{/products/edit/{id}(id=${product.id})}" class="btn btn-sm btn-cyber-sm">
                <i class="bi bi-pencil"></i>
              </a>
              <form th:action="@{/products/delete/{id}(id=${product.id})}"
                    th:method="post"
                    sec:authorize="${hasAnyRole('ADMIN','MANAGER')}"
                    class="d-inline">
                <button class="btn btn-sm btn-cyber-danger-sm" onclick="return confirm('ERASE_SECTOR: Вы уверены?')">
                  <i class="bi bi-trash"></i>
                </button>
              </form>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="modal fade" id="productModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content terminal-window">
        <div class="modal-header border-secondary">
          <h5 class="modal-title text-info font-monospace">INITIALIZE_NEW_PRODUCT</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <form th:action="@{/products}" th:object="${product}" method="post">
          <div class="modal-body">
            <div class="row">
              <div class="col-md-12 mb-3">
                <label class="form-label x-small">> PRODUCT_TITLE</label>
                <input type="text" class="form-control cyber-input" th:field="*{title}"
                       placeholder="Введите название..." required>
              </div>
              <div class="col-md-12 mb-3">
                <label class="form-label x-small">> CATEGORY_ID</label>
                <select class="form-select cyber-input" th:field="*{categoryId}" required>
                  <option value="">CHOOSE_SECTOR...</option>
                  <option th:each="category : ${categories}" th:value="${category.id}" th:text="${category.name}"></option>
                </select>
              </div>
              <div class="col-md-12">
                <label class="form-label x-small">> DESCRIPTION_RAW</label>
                <textarea class="form-control cyber-input" th:field="*{description}" rows="4"
                          placeholder="Описание сущности..."></textarea>
              </div>
            </div>
          </div>
          <div class="modal-footer border-secondary">
            <button type="button" class="btn btn-cyber-sm" data-bs-dismiss="modal">CANCEL</button>
            <button type="submit" class="btn btn-cyber">INJECT_DATA</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
</html>