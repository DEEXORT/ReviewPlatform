<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<body>
<div th:fragment="productsContent">
  <div class="container mt-4">
    <!-- Форма -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0" th:text="${product?.id != null} ? 'Редактировать продукт' : 'Добавить продукт'">
          Добавить продукт
        </h5>
      </div>
      <div class="card-body">
        <form th:action="@{/products}" th:object="${product}" th:method="post">
          <input type="hidden" th:field="*{id}">

          <div class="form-group mb-3">
            <label for="title" class="form-label">Наименование *</label>
            <input type="text" class="form-control" id="title" th:field="*{title}" required>
            <small class="form-text text-danger" th:if="${#fields.hasErrors('title')}"
                   th:errors="*{title}"></small>
          </div>

          <div class="form-group mb-3">
            <label for="description" class="form-label">Описание</label>
            <textarea class="form-control" id="description" th:field="*{description}"
                      rows="2"></textarea>
          </div>

          <div class="form-group mb-3">
            <label for="category" class="form-label">Выбор категории *</label>
            <select class="form-control" id="category" th:field="*{category.id}" required>
              <option value="">Выберите категорию...</option>
              <option th:each="category : ${categories}"
                      th:value="${category.id}"
                      th:text="${category.name}">
              </option>
            </select>
            <small class="form-text text-danger" th:if="${#fields.hasErrors('category')}"
                   th:errors="*{category}"></small>
          </div>

          <div class="d-flex gap-2">
            <button type="submit" class="btn btn-primary">
              <span th:text="${product?.id != null} ? 'Обновить' : 'Сохранить'">Сохранить</span>
            </button>
            <a th:href="@{/products}" class="btn btn-secondary" th:if="${product?.id != null}">
              Отмена
            </a>
          </div>
        </form>
      </div>
    </div>

    <!-- Таблица продуктов -->
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Список продуктов</h5>
        <span class="badge bg-primary" th:text="${products.size()} + ' шт.'"></span>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead class="table-light">
            <tr>
              <th scope="col">#</th>
              <th scope="col">Наименование</th>
              <th scope="col">Категория</th>
              <th scope="col">Описание</th>
              <th scope="col" class="text-center">Действия</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="product, iterStat : ${products}">
              <td th:text="${iterStat.count}"></td>
              <td th:text="${product.title}"></td>
              <td>
                <span class="badge bg-info" th:text="${product.category?.name} ?: 'Без категории'"></span>
              </td>
              <td>
                <span th:if="${product.description}" th:text="${product.description}"></span>
                <span th:unless="${product.description}" class="text-muted fst-italic">—</span>
              </td>
              <td>
                <div class="d-flex justify-content-center gap-2">
                  <a th:href="@{/products/edit/{id}(id=${product.id})}"
                     class="btn btn-sm btn-outline-primary">
                    Изменить
                  </a>
                  <a th:href="@{/reviews/products/{id}(id=${product.id})}"
                     class="btn btn-sm btn-outline-warning">
                    Оценить
                  </a>
                  <form th:action="@{/products/delete/{id}(id=${product.id})}"
                        method="post"
                        class="d-inline"
                        onsubmit="return confirm('Удалить продукт?')">
                    <button type="submit" class="btn btn-sm btn-outline-danger">
                      Удалить
                    </button>
                  </form>
                </div>
              </td>
            </tr>

            <tr th:if="${#lists.isEmpty(products)}">
              <td colspan="5" class="text-center text-muted py-4">
                <div class="py-3">
                  <i class="bi bi-box-seam display-6 text-muted"></i>
                  <p class="mt-2 mb-0">Продукты не найдены</p>
                  <p class="small">Добавьте первый продукт</p>
                </div>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Автофокус на поле ввода
    document.addEventListener('DOMContentLoaded', function() {
      const titleInput = document.getElementById('title');
      if (titleInput) {
        titleInput.focus();
      }
    });

    // Подтверждение удаления
    function confirmDelete() {
      return confirm('Вы уверены, что хотите удалить этот продукт?');
    }
  </script>
</div>
</body>
</html>